# BloodHound with Kali Linux: 101

This lab is to see what it takes to install BloodHound on Kali Linux as well as a brief exploration of the UI, understanding what it shows and how it can help a pentester/redteamer to escalate privileges in order to reach their objectives.

## Context

> BloodHound is a single page Javascript web application, built on top of [Linkurious](http://linkurio.us/), compiled with [Electron](http://electron.atom.io/), with a [Neo4j](https://neo4j.com/)database fed by a PowerShell ingestor.
>
> BloodHound uses graph theory to reveal the hidden and often unintended relationships within an Active Directory environment. Attackers can use BloodHound to easily identify highly complex attack paths that would otherwise be impossible to quickly identify. Defenders can use BloodHound to identify and eliminate those same attack paths. Both blue and red teams can use BloodHound to easily gain a deeper understanding of privilege relationships in an Active Directory environment.
>
> BloodHound is developed by [@\_wald0](https://www.twitter.com/_wald0), [@CptJesus](https://twitter.com/CptJesus), and [@harmj0y](https://twitter.com/harmj0y).
>
> From [https://github.com/BloodHoundAD/BloodHound](https://github.com/BloodHoundAD/BloodHound)

## Installing

It is surprising easy to install bloodhound these days from Kali Linux:

{% code-tabs %}
{% code-tabs-item title="attacker@kali" %}
```csharp
apt-get install bloodhound
```
{% endcode-tabs-item %}
{% endcode-tabs %}

The package manager will install a neo4j database management solution that is required for BloodHound. 

## Settings

Once installation is completed, run:

{% code-tabs %}
{% code-tabs-item title="attacker@kali" %}
```csharp
neo4j console
```
{% endcode-tabs-item %}
{% endcode-tabs %}

![](../../.gitbook/assets/screenshot-from-2019-01-03-18-18-03.png)

Navigate to [http://localhost:7474/](http://localhost:7474/) to set up a DB user account by changing default passwords **neo4j:neo4j** to something else - we will need those credentials when launching bloodhound itself.

## Running BloodHound

{% code-tabs %}
{% code-tabs-item title="attacker@kali" %}
```text
bloodhound
```
{% endcode-tabs-item %}
{% endcode-tabs %}

Login with your previously set credentials:

![](../../.gitbook/assets/screenshot-from-2019-01-03-18-22-00.png)

## Enumeration & Data Ingestion

BloodHound without any data is not useful. BloodHound is very good at visualising Active Directory object relationships and various permissions between those relationships. In order for BloodHound to do its magic, we need to enumerate the victim domain. That enumeration process produces a JSON file that describes the various AD goodies mentioned earlier, that can then be imported to BloodHound which will allow us to visually see various ways \(if any\) how Active Directory and its various objects can be used to elevate our privileges to Domain Admin.

### SharpHound

The tool that does the aforementioned AD enumeration is called [SharpHound](https://github.com/BloodHoundAD/BloodHound/tree/master/Ingestors).

I tried running the BloodHound ingestor from an account that was not a domain member, so I got the following:

![](../../.gitbook/assets/screenshot-from-2019-01-02-23-16-33.png)

Just a nice thing to remember - get a shell with domain member credentials:

{% code-tabs %}
{% code-tabs-item title="attacker@victim" %}
```csharp
runas /user:spotless@offense powershell
```
{% endcode-tabs-item %}
{% endcode-tabs %}

We can now proceed to AD enumeration:

{% code-tabs %}
{% code-tabs-item title="attacker@victim" %}
```csharp
. .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All -JSONFolder "c:\experiments\bloodhound"
```
{% endcode-tabs-item %}
{% endcode-tabs %}

![](../../.gitbook/assets/screenshot-from-2019-01-03-18-42-33.png)

We can now take the .zip file that was generated by Invoke-BloodHound and just drag and drop it to the BloodHound interface for ingestion. Once the ingestion is complete, we can play around with Queries that actually visualise the data that was ingested:

![](../../.gitbook/assets/peek-2019-01-03-18-44.gif)



![](../../.gitbook/assets/screenshot-from-2019-01-02-23-47-56.png)

![](../../.gitbook/assets/screenshot-from-2019-01-02-23-55-41.png)

![](../../.gitbook/assets/screenshot-from-2019-01-02-23-56-35.png)



{% page-ref page="abusing-active-directory-acls-aces.md" %}

{% embed url="https://github.com/BloodHoundAD/BloodHound/wiki" %}

